<!DOCTYPE html>
<html lang="th">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>บัตรเลือกตั้ง | ระบบนับคะแนนการเลือกตั้งสภานักเรียน</title>

    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Prompt:wght@300;400;500;600;700;800&display=swap"
        rel="stylesheet">

    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- API Client -->
    <meta name="gas-api-url" content="https://script.google.com/macros/s/YOUR_DEPLOYMENT_ID/exec">
    <script src="api.js"></script>

    <!-- CSS -->
    <style>
        :root {
            --color-primary-green: #2A9D8F;
            --color-primary-yellow: #E9C46A;
            --color-primary-black: #264653;
            --color-bg-white: #FFFFFF;
            --color-bg-light: #F0F4F8;
            --color-bg-cream: #FFFBF0;
            --color-accent-green: #1D7A70;
            --color-accent-yellow: #D4A84B;
            --color-text-main: #1D1D1F;
            --color-text-dark: #1D1D1F;
            --color-text-muted: #6E6E73;
            --color-success: #27AE60;
            --color-warning: #F39C12;
            --color-danger: #E74C3C;
            --color-gold: #D4AF37;
            --color-silver: #8E8E93;
            --color-bronze: #CD7F32;
            --color-border: #e5e7eb;
            --border-radius-sm: 8px;
            --border-radius-md: 16px;
            --border-radius-lg: 24px;
            --shadow-sm: 0 2px 8px rgba(0, 0, 0, .05);
            --shadow-md: 0 4px 16px rgba(0, 0, 0, .1);
            --shadow-lg: 0 8px 30px rgba(0, 0, 0, .15);
            --shadow-xl: 0 20px 50px rgba(0, 0, 0, .2);
            --transition-fast: .2s ease;
            --transition-normal: .3s cubic-bezier(.4, 0, .2, 1)
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box
        }

        body {
            font-family: Prompt, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e9f0 50%, #e8f0f2 100%);
            color: var(--color-text-main);
            line-height: 1.6;
            min-height: 100vh;
            display: flex;
            flex-direction: column
        }

        /* ===== HEADER - Minimal & Beautiful ===== */
        .header {
            background: linear-gradient(135deg, var(--color-primary-black) 0%, #1a3540 50%, #15313d 100%);
            color: white;
            padding: 16px 0;
            box-shadow: 0 4px 20px rgba(38, 70, 83, .3);
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px);
        }

        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
            display: flex;
            align-items: center;
            justify-content: space-between
        }

        .logo-group {
            display: flex;
            align-items: center;
            gap: 14px
        }

        .logo-placeholder {
            width: 44px;
            height: 44px;
            background: rgba(255, 255, 255, .1);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            border: 2px solid rgba(255, 255, 255, .2);
            overflow: hidden;
            transition: var(--transition-normal);
        }

        .logo-placeholder:hover {
            border-color: rgba(255, 255, 255, .5);
            transform: scale(1.05);
        }

        @media (max-width: 600px) {
            .header {
                padding: 10px 0;
            }

            .logo-placeholder {
                width: 32px;
                height: 32px;
            }

            .system-title h1 {
                font-size: 0.88rem;
                letter-spacing: -0.01em;
            }

            .system-title span {
                font-size: 0.62rem;
            }

            .header-actions {
                display: none;
                /* Hide standard nav for mobile */
            }

            .menu-toggle {
                display: flex;
                /* Show hamburger */
            }
        }

        /* Mobile Menu Button */
        .menu-toggle {
            display: none;
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            width: 40px;
            height: 40px;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            z-index: 101;
            transition: all 0.2s ease;
        }

        /* Mobile Menu Overlay */
        .mobile-menu {
            position: fixed;
            top: 0;
            right: -100%;
            width: 80%;
            max-width: 300px;
            height: 100vh;
            background: var(--color-primary-black);
            z-index: 1000;
            padding: 80px 24px 40px;
            transition: right 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            box-shadow: -10px 0 30px rgba(0, 0, 0, 0.3);
            display: flex;
            flex-direction: column;
            gap: 15px;
            color: white;
        }

        .mobile-menu.active {
            right: 0;
        }

        .mobile-menu-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0, 0, 0, 0.4);
            backdrop-filter: blur(4px);
            z-index: 999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.3s ease;
        }

        .mobile-menu-overlay.active {
            opacity: 1;
            pointer-events: auto;
        }

        .mobile-nav-link {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 14px 16px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            color: white;
            text-decoration: none;
            font-weight: 500;
            font-size: 0.95rem;
            transition: all 0.2s ease;
        }

        .mobile-nav-link i {
            width: 20px;
            text-align: center;
            color: var(--color-primary-yellow);
        }

        .mobile-nav-link.active {
            background: rgba(233, 196, 106, 0.2);
            color: var(--color-primary-yellow);
            border-color: rgba(233, 196, 106, 0.3);
        }

        .mobile-menu-header {
            margin-bottom: 20px;
            padding-bottom: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .mobile-menu-header h3 {
            font-size: 1.1rem;
            font-weight: 700;
            color: white;
        }

        .mobile-menu-header p {
            font-size: 0.75rem;
            color: rgba(255, 255, 255, 0.6);
        }

        .logo-placeholder img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 50%
        }

        .system-title {
            display: flex;
            flex-direction: column
        }

        .system-title h1 {
            font-size: 1.15rem;
            font-weight: 700;
            letter-spacing: -.3px
        }

        .system-title span {
            font-size: .75rem;
            opacity: .7;
            font-weight: 400
        }

        .header-actions {
            display: flex;
            gap: 10px
        }

        .btn {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            padding: 10px 20px;
            border-radius: 12px;
            font-weight: 600;
            font-size: .9rem;
            cursor: pointer;
            transition: var(--transition-normal);
            border: none;
            font-family: inherit;
            text-decoration: none;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, .1);
            color: white;
            border: 1.5px solid rgba(255, 255, 255, .25);
            backdrop-filter: blur(4px);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, .2);
            border-color: rgba(255, 255, 255, .5);
            transform: translateY(-1px);
        }

        .btn-sm {
            padding: 8px 14px;
            font-size: .85rem
        }

        /* ===== MAIN CONTENT ===== */
        .main-content {
            flex: 1;
            max-width: 1200px;
            margin: 0 auto;
            padding: 30px 20px;
            width: 100%
        }

        /* ===== BALLOT WRAPPER ===== */
        .ballot-wrapper {
            max-width: 680px;
            margin: 10px auto;
            background: #fff;
            border-radius: var(--border-radius-lg);
            box-shadow: var(--shadow-lg);
            overflow: hidden;
            animation: slideUpFade .6s ease;
        }

        @keyframes slideUpFade {
            from {
                opacity: 0;
                transform: translateY(20px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .ballot-header-strip {
            background: linear-gradient(135deg, var(--color-primary-black), #1a3540);
            color: #fff;
            padding: 14px 28px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-weight: 600;
            font-size: .85rem
        }

        .ballot-header-left {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .ballot-paper {
            background: linear-gradient(135deg, #FFFDF7, #FFF9E6, #FFFBF0);
            border-left: 4px dashed rgba(38, 70, 83, .2);
            border-right: 4px dashed rgba(38, 70, 83, .2);
            padding: 32px 28px;
            position: relative
        }

        @media (max-width: 600px) {
            .ballot-paper {
                padding: 24px 16px;
                border-left-width: 2px;
                border-right-width: 2px;
            }

            .ballot-title h2 {
                font-size: 1.25rem;
            }

            .ballot-option {
                padding: 14px 16px;
                gap: 12px;
            }

            .ballot-checkbox {
                width: 52px;
                height: 52px;
                margin-right: 8px;
            }

            .ballot-mark {
                font-size: 2.3rem;
            }

            .ballot-option-name {
                font-size: 1rem;
            }

            .ballot-submit-btn {
                padding: 15px 32px;
                font-size: 1.1rem;
                width: 100%;
                border-radius: 12px;
            }

            .ballot-success-icon {
                font-size: 3.5rem;
            }

            .ballot-success-detail {
                font-size: 1.4rem;
            }
        }

        .ballot-title {
            text-align: center;
            margin-bottom: 28px
        }

        .ballot-title h2 {
            font-size: 1.45rem;
            color: var(--color-primary-black);
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .ballot-instruction {
            color: var(--color-text-muted);
            font-size: .88rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 6px;
        }

        .ballot-options {
            display: flex;
            flex-direction: column;
            gap: 14px
        }

        .ballot-option {
            background: #fff;
            border: 2px solid var(--color-border);
            border-radius: 14px;
            padding: 20px 22px;
            display: flex;
            align-items: center;
            gap: 20px;
            cursor: pointer;
            transition: all .3s cubic-bezier(.4, 0, .2, 1);
            position: relative;
            overflow: hidden
        }

        .ballot-option::before {
            content: '';
            position: absolute;
            left: 0;
            top: 0;
            bottom: 0;
            width: 4px;
            background: transparent;
            transition: background .3s ease;
            border-radius: 0 4px 4px 0;
        }

        .ballot-option:hover {
            border-color: var(--color-primary-green);
            background: #f0faf8;
            transform: translateX(4px);
        }

        .ballot-option:hover::before {
            background: var(--color-primary-green);
        }

        .ballot-option.selected {
            border-color: var(--color-primary-green);
            background: rgba(42, 157, 143, .08);
            box-shadow: 0 0 0 3px rgba(42, 157, 143, .1);
            transform: translateX(4px);
        }

        .ballot-option.selected::before {
            background: var(--color-primary-green);
        }

        .ballot-checkbox {
            width: 62px;
            height: 62px;
            border: 2px solid #e2e8f0;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all .3s cubic-bezier(0.4, 0, 0.2, 1);
            background: #fff;
            position: relative;
            flex-shrink: 0;
            overflow: hidden;
            margin-right: 18px;
        }

        .ballot-checkbox img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            filter: grayscale(0%) opacity(1);
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* When a selection is made, all logos go grayscale */
        .ballot-paper.has-selection .ballot-checkbox img {
            filter: grayscale(100%) opacity(0.6);
        }

        .ballot-option.selected .ballot-checkbox {
            border-color: var(--color-danger);
            transform: scale(1.05);
            box-shadow: 0 0 0 5px rgba(231, 76, 60, 0.15);
        }

        .ballot-option.selected .ballot-checkbox img {
            filter: grayscale(100%) opacity(0.8);
        }

        .ballot-mark {
            font-size: 2.8rem;
            color: var(--color-danger);
            font-weight: 800;
            display: none;
            position: absolute;
            z-index: 5;
            text-shadow: 0 0 12px #fff, 0 0 12px #fff, 0 0 12px #fff;
            pointer-events: none;
            line-height: 1;
        }

        .ballot-option.selected .ballot-mark {
            display: block;
            animation: markZoom 0.25s cubic-bezier(0.175, 0.885, 0.32, 1.275);
        }

        /* No Vote Specific Box */
        .no-vote-option .ballot-checkbox {
            border-radius: 12px;
            background: #f8fafc;
        }

        .no-vote-option .ballot-checkbox i {
            font-size: 1.8rem;
            color: #cbd5e1;
            transition: all 0.3s;
        }

        .no-vote-option.selected .ballot-checkbox i {
            color: var(--color-danger);
            opacity: 0.3;
        }

        @keyframes markZoom {
            0% {
                transform: scale(0);
                opacity: 0;
            }

            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .ballot-option-info {
            flex: 1;
        }

        .ballot-option-number {
            font-weight: 600;
            color: var(--color-primary-green);
            font-size: .95rem
        }

        .ballot-option-name {
            font-size: 1.1rem;
            font-weight: 700;
            color: var(--color-primary-black)
        }

        .ballot-option-number-big {
            position: absolute;
            right: -8px;
            bottom: -16px;
            font-size: 6rem;
            font-weight: 900;
            color: var(--color-primary-black);
            opacity: .03;
            pointer-events: none
        }

        .ballot-divider {
            height: 1.5px;
            background: linear-gradient(90deg, transparent, var(--color-border), transparent);
            margin: 8px 0;
        }

        .no-vote-option {
            border-style: dashed;
        }

        .ballot-submit-area {
            margin-top: 32px;
            text-align: center
        }

        .ballot-submit-btn {
            background: linear-gradient(135deg, var(--color-primary-green), var(--color-accent-green));
            color: #fff;
            border: none;
            padding: 16px 44px;
            font-size: 1.2rem;
            font-weight: 700;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 6px 20px rgba(42, 157, 143, .3);
            transition: all .3s cubic-bezier(.4, 0, .2, 1);
            display: inline-flex;
            align-items: center;
            gap: 10px;
            font-family: inherit;
        }

        .ballot-submit-btn:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 10px 28px rgba(42, 157, 143, .4)
        }

        .ballot-submit-btn:active:not(:disabled) {
            transform: translateY(-1px);
        }

        .ballot-submit-btn:disabled {
            background: linear-gradient(135deg, #c8d6d3, #b0bec5);
            box-shadow: none;
            cursor: not-allowed;
            opacity: .7
        }

        .ballot-submit-hint {
            margin-top: 14px;
            color: var(--color-text-muted);
            font-size: .85rem
        }

        /* ===== BALLOT FOOTER STRIP ===== */
        .ballot-footer-strip {
            background: var(--color-primary-black);
            color: rgba(255, 255, 255, .7);
            padding: 12px 28px;
            font-size: .8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        /* ===== SUCCESS OVERLAY ===== */
        .ballot-success-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(135deg, rgba(42, 157, 143, .97), rgba(29, 122, 112, .97));
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
            color: #fff;
            text-align: center
        }

        .ballot-success-overlay.active {
            display: flex;
            animation: fadeIn .3s ease
        }

        .ballot-success-content {
            animation: scaleUp .5s cubic-bezier(.34, 1.56, .64, 1);
        }

        .ballot-success-icon {
            font-size: 5rem;
            margin-bottom: 16px;
        }

        .ballot-success-detail {
            font-size: 1.8rem;
            font-weight: 800;
            margin: 12px 0
        }

        .ballot-success-hint {
            opacity: .8;
            font-size: .95rem;
        }

        .ballot-success-progress {
            width: 200px;
            height: 4px;
            background: rgba(255, 255, 255, .2);
            border-radius: 2px;
            margin: 18px auto;
            overflow: hidden
        }

        .ballot-success-bar {
            height: 100%;
            background: #fff;
            width: 0;
            transition: width 2.5s linear
        }

        @keyframes fadeIn {
            from {
                opacity: 0
            }

            to {
                opacity: 1
            }
        }

        @keyframes scaleUp {
            from {
                transform: scale(0);
                opacity: 0
            }

            to {
                transform: scale(1);
                opacity: 1
            }
        }

        .confetti-piece {
            position: absolute;
            width: 10px;
            height: 10px;
            background: #fff;
            top: -10px;
            animation: confettiFall 3s linear forwards
        }

        @keyframes confettiFall {
            to {
                transform: translateY(100vh) rotate(720deg);
                opacity: 0
            }
        }

        /* ===== LOGIN MODAL ===== */
        .login-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, .88);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            z-index: 9999;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
            transition: opacity .3s ease;
        }

        .login-modal {
            background: #fff;
            padding: 36px 32px;
            border-radius: 20px;
            width: 100%;
            max-width: 400px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
            animation: slideUp 0.4s cubic-bezier(.34, 1.56, .64, 1);
            position: relative;
        }

        @keyframes slideUp {
            from {
                transform: translateY(30px);
                opacity: 0
            }

            to {
                transform: translateY(0);
                opacity: 1
            }
        }

        .login-header i {
            font-size: 2.5rem;
            color: var(--color-primary-green);
            margin-bottom: 16px;
            background: linear-gradient(135deg, #E6F4F1, #d0ece8);
            width: 72px;
            height: 72px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .login-header h2 {
            font-size: 1.5rem;
            margin-bottom: 8px;
            color: var(--color-primary-black);
        }

        .login-header p {
            color: var(--color-text-muted);
            margin-bottom: 24px;
            font-size: .9rem;
        }

        .input-group input {
            width: 100%;
            padding: 14px;
            font-size: 1.1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            text-align: center;
            margin-bottom: 16px;
            transition: all 0.2s;
            font-family: inherit;
            background: #fafbfc;
        }

        .input-group input:focus {
            border-color: var(--color-primary-green);
            outline: none;
            box-shadow: 0 0 0 4px rgba(42, 157, 143, 0.1);
            background: #fff;
        }

        .login-btn {
            background: linear-gradient(135deg, var(--color-primary-green), var(--color-accent-green));
            color: white;
            border: none;
            width: 100%;
            padding: 14px;
            font-size: 1.05rem;
            font-weight: 600;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.25s;
            font-family: inherit;
        }

        .login-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(42, 157, 143, .3);
        }

        .login-btn:disabled {
            background: linear-gradient(135deg, #b0bec5, #90a4ae);
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .login-exit-btn {
            background: none;
            border: 1.5px solid #e5e7eb;
            color: var(--color-text-muted);
            width: 100%;
            padding: 12px;
            font-size: .95rem;
            font-weight: 500;
            border-radius: 12px;
            cursor: pointer;
            transition: all 0.2s;
            font-family: inherit;
            margin-top: 10px;
        }

        .login-exit-btn:hover {
            background: #f8f9fa;
            border-color: #d1d5db;
            color: var(--color-text-main);
        }

        .login-error {
            color: var(--color-danger);
            background: #fff5f5;
            padding: 10px 14px;
            border-radius: 8px;
            margin-bottom: 16px;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 8px;
            text-align: left;
            border: 1px solid rgba(231, 76, 60, .15);
        }

        /* ===== EXIT CONFIRM MODAL ===== */
        .confirm-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(15, 23, 42, .7);
            backdrop-filter: blur(4px);
            -webkit-backdrop-filter: blur(4px);
            z-index: 10000;
            display: none;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .confirm-modal-overlay.active {
            display: flex;
        }

        .confirm-modal {
            background: #fff;
            padding: 32px 28px;
            border-radius: 20px;
            width: 100%;
            max-width: 380px;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0, 0, 0, .3);
            animation: slideUp 0.3s ease;
        }

        .confirm-modal h3 {
            font-size: 1.2rem;
            color: var(--color-primary-black);
            margin-bottom: 8px;
        }

        .confirm-modal p {
            color: var(--color-text-muted);
            font-size: .88rem;
            margin-bottom: 20px;
        }

        .confirm-modal input {
            width: 100%;
            padding: 12px;
            font-size: 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 10px;
            text-align: center;
            margin-bottom: 16px;
            font-family: inherit;
            background: #fafbfc;
        }

        .confirm-modal input:focus {
            border-color: var(--color-primary-green);
            outline: none;
            box-shadow: 0 0 0 3px rgba(42, 157, 143, .1);
            background: #fff;
        }

        .confirm-modal-actions {
            display: flex;
            gap: 10px;
        }

        .confirm-modal-actions button {
            flex: 1;
            padding: 12px;
            border-radius: 10px;
            font-weight: 600;
            font-size: .9rem;
            cursor: pointer;
            transition: all .2s;
            font-family: inherit;
            border: none;
        }

        .confirm-cancel-btn {
            background: #f1f5f9;
            color: var(--color-text-main);
        }

        .confirm-cancel-btn:hover {
            background: #e2e8f0;
        }

        .confirm-submit-btn {
            background: linear-gradient(135deg, var(--color-danger), #c0392b);
            color: white;
        }

        .confirm-submit-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(231, 76, 60, .3);
        }

        .confirm-error {
            color: var(--color-danger);
            font-size: .85rem;
            margin-bottom: 12px;
            display: none;
        }

        /* ===== LOCKED BANNER ===== */
        .locked-banner {
            background: linear-gradient(135deg, #FFF3CD, #FFF9E6);
            color: #856404;
            padding: 16px 20px;
            border-radius: 14px;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 16px;
            border: 1px solid #FFEEBA;
            max-width: 680px;
            margin-left: auto;
            margin-right: auto;
        }

        .locked-banner i {
            font-size: 1.5rem;
        }

        /* ===== FOOTER ===== */
        .footer {
            background: var(--color-primary-black);
            color: white;
            padding: 24px 20px;
            text-align: center;
            margin-top: auto
        }

        .footer-disclaimer {
            font-size: .82rem;
            opacity: .8;
            margin-bottom: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex-wrap: wrap;
        }

        .footer-dev {
            font-size: .75rem;
            opacity: .5
        }

        /* ===== RESPONSIVE ===== */
        @media (max-width: 768px) {
            .header-content {
                gap: 12px;
            }

            .logo-placeholder {
                width: 36px;
                height: 36px;
            }

            .system-title h1 {
                font-size: 1rem;
            }

            .system-title span {
                font-size: .7rem;
            }

            .main-content {
                padding: 20px 12px;
            }

            .ballot-paper {
                padding: 24px 18px;
            }

            .ballot-title h2 {
                font-size: 1.2rem;
            }

            .ballot-option {
                padding: 16px 14px;
                gap: 14px;
            }

            .ballot-checkbox {
                width: 36px;
                height: 36px;
                font-size: 1.5rem;
            }

            .ballot-option-name {
                font-size: 1rem;
            }

            .ballot-option-number-big {
                font-size: 4rem;
            }

            .ballot-submit-btn {
                padding: 14px 36px;
                font-size: 1.1rem;
            }

            .ballot-header-strip {
                padding: 12px 18px;
                font-size: .8rem;
            }
        }

        @media (max-width: 480px) {
            .header {
                padding: 12px 0;
            }

            .logo-group {
                gap: 10px;
            }

            .logo-placeholder:nth-child(2) {
                display: none;
            }

            .system-title h1 {
                font-size: .9rem;
            }

            .btn-sm {
                padding: 6px 10px;
                font-size: .8rem;
            }

            .ballot-paper {
                padding: 20px 14px;
            }

            .ballot-option {
                padding: 14px 12px;
                gap: 12px;
            }

            .ballot-checkbox {
                width: 32px;
                height: 32px;
                font-size: 1.3rem;
            }

            .ballot-option-name {
                font-size: .92rem;
            }

            .ballot-option-number {
                font-size: .85rem;
            }

            .ballot-submit-btn {
                padding: 12px 28px;
                font-size: 1rem;
                width: 100%;
            }

            .login-modal {
                padding: 28px 22px;
            }

            .confirm-modal {
                padding: 28px 22px;
            }
        }

        /* Loading indicator */
        #loadingIndicator {
            text-align: center;
            padding: 40px;
        }
    </style>
</head>

<body>
    <!-- Login Modal removed — voting is direct, no identity verification -->


    <!-- Exit Confirm Modal (Password Required) -->
    <div id="exitConfirmModal" class="confirm-modal-overlay">
        <div class="confirm-modal">
            <i class="fa-solid fa-shield-halved"
                style="font-size: 2rem; color: var(--color-primary-green); margin-bottom: 12px;"></i>
            <h3>ยืนยันการออก</h3>
            <p>กรุณาใส่รหัสสภานักเรียน<br>เพื่อยืนยันการออกจากหน้าลงคะแนน</p>
            <div id="exitError" class="confirm-error">
                <i class="fa-solid fa-circle-exclamation"></i> รหัสไม่ถูกต้อง
            </div>
            <input type="password" id="exitPassword" placeholder="รหัสสภานักเรียน"
                onkeyup="if(event.key==='Enter')confirmExit()">
            <div class="confirm-modal-actions">
                <button class="confirm-cancel-btn" onclick="closeExitModal()">ยกเลิก</button>
                <button class="confirm-submit-btn" onclick="confirmExit()">
                    <i class="fa-solid fa-right-from-bracket"></i> ออก
                </button>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header class="header">
        <div class="header-content">
            <div class="logo-group">
                <div class="logo-placeholder" title="โลโก้โรงเรียน">
                    <img src="https://drive.google.com/thumbnail?id=1l-r_ZGA-N4rKipi5zz4DKOoMJL-W82zW&sz=w300"
                        alt="ตราโรงเรียน">
                </div>
                <div class="logo-placeholder" title="โลโก้สภานักเรียน">
                    <img src="https://drive.google.com/thumbnail?id=1MTw6a6RfcCU-QTIQQ_EyhHLB_8CE9vHy&sz=w300"
                        alt="ตราสภานักเรียน">
                </div>
                <div class="system-title">
                    <h1>บัตรเลือกตั้งสภานักเรียน</h1>
                    <span>ประจำปีการศึกษา 2569 | โรงเรียนศรีวิชัยวิทยา</span>
                </div>
            </div>
            <div class="header-actions">
                <button class="btn btn-secondary btn-sm" onclick="requestExit()">
                    <i class="fa-solid fa-arrow-left"></i> กลับหน้าหลัก
                </button>
            </div>

            <!-- Mobile Hamburger Button -->
            <button class="menu-toggle" onclick="toggleMobileMenu()" id="menuToggleBtn">
                <i class="fa-solid fa-bars"></i>
            </button>
        </div>
    </header>

    <!-- Mobile Menu Overlay -->
    <div class="mobile-menu-overlay" id="menuOverlay" onclick="toggleMobileMenu()"></div>
    <div class="mobile-menu" id="mobileMenu">
        <div class="mobile-menu-header">
            <h3>เมนูระบบ</h3>
            <p>ระบบนับคะแนนสภานักเรียน</p>
        </div>

        <a href="#" onclick="requestExit(); toggleMobileMenu(); return false;" class="mobile-nav-link">
            <i class="fa-solid fa-arrow-left"></i>
            กลับหน้าหลัก
        </a>
        <a href="#" onclick="navigateTo('ranking'); toggleMobileMenu(); return false;" class="mobile-nav-link">
            <i class="fa-solid fa-tv"></i>
            ผลคะแนนสด
        </a>

        <div style="margin-top: auto;">
            <p style="font-size: 0.7rem; color: rgba(255, 255, 255, 0.4); text-align: center; margin-bottom: 10px;">
                เลือกพรรคที่ต้องการและกด "ยืนยันการลงคะแนน"
            </p>
        </div>
    </div>

    <!-- Main Content -->
    <main class="main-content ballot-main">

        <!-- Locked Banner -->
        <div class="locked-banner" id="lockedBanner" style="display: none;">
            <i class="fa-solid fa-lock"></i>
            <div>
                <h3>ผลการนับคะแนนถูกล็อคแล้ว</h3>
                <p>ไม่สามารถลงคะแนนเพิ่มได้</p>
            </div>
        </div>

        <!-- Loading indicator -->
        <div id="loadingIndicator" style="display: none;">
            <i class="fa-solid fa-spinner fa-spin" style="font-size: 2rem; color: var(--color-primary-green);"></i>
            <p style="margin-top: 12px; color: var(--color-text-muted);">กำลังบันทึกคะแนน...</p>
        </div>

        <!-- Ballot Paper -->
        <div class="ballot-wrapper" id="ballotWrapper">
            <!-- Ballot Header -->
            <div class="ballot-header-strip">
                <div class="ballot-header-left">
                    <i class="fa-solid fa-landmark"></i>
                    <span>บัตรเลือกตั้ง</span>
                </div>
                <div class="ballot-header-right">
                    สภานักเรียน ปีการศึกษา 2569
                </div>
            </div>

            <div class="ballot-paper" id="ballotPaper">
                <!-- Ballot Title -->
                <div class="ballot-title">
                    <h2><i class="fa-solid fa-check-to-slot"></i> กากบาทเลือกเบอร์ที่ต้องการ</h2>
                    <p class="ballot-instruction">
                        <i class="fa-solid fa-circle-info"></i>
                        กดเลือกได้เพียง 1 ช่องเท่านั้น แล้วกดปุ่ม "หย่อนบัตร" เพื่อยืนยัน
                    </p>
                </div>

                <!-- Ballot Options (Dynamic) -->
                <div class="ballot-options" id="ballotOptionsContainer">
                    <!-- Rendered dynamically from PartyConfig -->
                    <div style="text-align:center;padding:40px;color:var(--color-text-muted)">
                        <i class="fa-solid fa-spinner fa-spin"
                            style="font-size:2rem;margin-bottom:12px;display:block"></i>
                        กำลังโหลดข้อมูลพรรค...
                    </div>
                </div>

                <!-- Submit Button -->
                <div class="ballot-submit-area">
                    <button class="ballot-submit-btn" id="submitBtn" onclick="submitBallot()" disabled>
                        <i class="fa-solid fa-box-archive"></i>
                        หย่อนบัตร
                    </button>
                    <p class="ballot-submit-hint" id="submitHint">
                        <i class="fa-solid fa-hand-pointer"></i> กรุณาเลือกกากบาทก่อนกดหย่อนบัตร
                    </p>
                </div>
            </div>

            <!-- Ballot Footer -->
            <div class="ballot-footer-strip">
                <span>โรงเรียนศรีวิชัยวิทยา</span>
                <span>•</span>
                <span>คณะกรรมการการเลือกตั้งสภานักเรียน</span>
            </div>
        </div>

        <!-- Success Overlay -->
        <div class="ballot-success-overlay" id="successOverlay">
            <div class="ballot-success-content">
                <div class="ballot-success-icon">
                    <i class="fa-solid fa-circle-check"></i>
                </div>
                <h2>บันทึกเรียบร้อย!</h2>
                <p>คะแนนถูกบันทึกลงระบบแล้ว</p>
                <div class="ballot-success-detail" id="successDetail"></div>
                <div class="ballot-success-progress">
                    <div class="ballot-success-bar" id="successBar"></div>
                </div>
                <p class="ballot-success-hint">กำลังเตรียมให้คนถัดไปลงคะแนน...</p>
            </div>
            <!-- Confetti container -->
            <div class="confetti-container" id="confettiContainer"></div>
        </div>

    </main>

    <!-- Footer -->
    <footer class="footer">
        <div class="footer-disclaimer">
            <i class="fa-solid fa-check-to-slot"></i>
            ระบบนี้ใช้เพื่อการลงคะแนนเลือกตั้งสภานักเรียน โรงเรียนศรีวิชัยวิทยา
        </div>
        <div class="footer-dev">
            พัฒนาโดย นายธีรเดช เดชสูงเนิน
        </div>
    </footer>

    <script>
        let selectedOption = null;
        let isSubmitting = false;
        let isLocked = false;
        let currentVoteToken = null;
        let partyConfig = {};

        // ===== VOTE TOKEN SYSTEM =====
        function fetchVoteToken() {
            if (isApiConfigured()) {
                apiPost('generateToken')
                    .then(function (result) {
                        currentVoteToken = result.token;
                        console.log('Vote token ready');
                    })
                    .catch(function (err) {
                        console.error('Failed to get vote token:', err);
                        setTimeout(fetchVoteToken, 2000);
                    });
            } else {
                currentVoteToken = 'local-' + Date.now() + '-' + Math.random().toString(36).substr(2, 9);
                console.log('Local token:', currentVoteToken);
            }
        }

        // ===== DYNAMIC BALLOT RENDERING =====
        function loadBallotOptions() {
            if (isApiConfigured()) {
                apiGet('getPartyConfig').then(function (config) {
                    partyConfig = config || {};
                    renderBallotOptions(config);
                }).catch(function (e) {
                    console.error('Failed to load party config:', e);
                    document.getElementById('ballotOptionsContainer').innerHTML = '<div style="text-align:center;padding:40px;color:var(--color-danger)"><i class="fa-solid fa-circle-exclamation" style="font-size:2rem;display:block;margin-bottom:12px"></i>ไม่สามารถโหลดข้อมูลพรรคได้</div>';
                });
            } else {
                var mock = { '1': { name: 'WANT TO TRY', logoId: '1EiYNuV1-q0tHLyaW7v_tksP1AXge-yAE', color: '#E63946' }, '2': { name: 'BETTER FUTURE', logoId: '1ONxc38OT-JR224YMv74d-xg3YbNmXg00', color: '#457B9D' }, '3': { name: 'คำว่าแร่ แพ้คำว่ารัก', logoId: '1UHLwn30CbToqTl58BSgz4J-kp_P33fPy', color: '#6A4C93' } };
                partyConfig = mock;
                renderBallotOptions(mock);
            }
        }

        function renderBallotOptions(config) {
            var ids = Object.keys(config);
            var html = '';
            ids.forEach(function (id) {
                var p = config[id];
                var logoHtml = p.logoId ? '<img src="https://drive.google.com/thumbnail?id=' + p.logoId + '&sz=w200" alt="Logo">' : '<i class="fa-solid fa-landmark" style="font-size:2rem;color:' + (p.color || '#264653') + '"></i>';
                html += '<div class="ballot-option" data-party="' + id + '" onclick="selectBallot(\'' + id + '\')">'
                    + '<div class="ballot-checkbox" id="checkbox-' + id + '">' + logoHtml + '<div class="ballot-mark">✗</div></div>'
                    + '<div class="ballot-option-info"><div class="ballot-option-number">เบอร์ ' + id + '</div><div class="ballot-option-name">' + p.name + '</div></div>'
                    + '<div class="ballot-option-number-big">' + id + '</div></div>';
            });
            html += '<div class="ballot-divider"></div>';
            html += '<div class="ballot-option no-vote-option" data-party="noVote" onclick="selectBallot(\'noVote\')">' +
                '<div class="ballot-checkbox" id="checkbox-noVote"><i class="fa-solid fa-ban"></i><div class="ballot-mark">✗</div></div>' +
                '<div class="ballot-option-info"><div class="ballot-option-number" style="color:var(--color-warning)"><i class="fa-solid fa-ban"></i> ไม่ประสงค์ลงคะแนน</div>' +
                '<div class="ballot-option-name" style="font-size:.82rem;color:var(--color-text-muted);font-weight:500">กากบาทช่องนี้หากไม่ต้องการเลือกพรรคใด</div></div></div>';
            document.getElementById('ballotOptionsContainer').innerHTML = html;
        }

        // ===== EXIT PASSWORD SYSTEM =====
        function requestExit() {
            document.getElementById('exitConfirmModal').classList.add('active');
            document.getElementById('exitPassword').value = '';
            document.getElementById('exitError').style.display = 'none';
            document.getElementById('exitPassword').focus();
        }

        function closeExitModal() {
            document.getElementById('exitConfirmModal').classList.remove('active');
        }

        function confirmExit() {
            var password = document.getElementById('exitPassword').value;
            if (isApiConfigured()) {
                apiPost('verifyPassword', { password: password, name: 'exit' })
                    .then(function (r) {
                        if (r.success) { navigateTo('index'); }
                        else { document.getElementById('exitError').style.display = 'block'; document.getElementById('exitPassword').value = ''; document.getElementById('exitPassword').focus(); }
                    })
                    .catch(function () {
                        document.getElementById('exitError').style.display = 'block';
                    });
            } else {
                if (password === 'admin2569' || password === 'vote2569') { navigateTo('index'); }
                else { document.getElementById('exitError').style.display = 'block'; document.getElementById('exitPassword').value = ''; }
            }
        }

        // Init: load ballot options + fetch token on page load
        window.addEventListener('load', function () {
            loadBallotOptions();
            fetchVoteToken();
        });

        function exitToHome() {
            requestExit();
        }

        // ===== SELECT BALLOT =====
        function selectBallot(party) {
            if (isSubmitting || isLocked) return;

            document.querySelectorAll('.ballot-option').forEach(function (opt) {
                opt.classList.remove('selected');
            });
            document.querySelectorAll('.ballot-checkbox').forEach(function (cb) {
                cb.classList.remove('checked');
            });

            const selectedElement = document.querySelector('.ballot-option[data-party="' + party + '"]');
            if (selectedElement) {
                selectedElement.classList.add('selected');
                selectedElement.querySelector('.ballot-checkbox').classList.add('checked');
                document.getElementById('ballotPaper').classList.add('has-selection');
            }

            selectedOption = party;
            document.getElementById('submitBtn').disabled = false;
            document.getElementById('submitHint').style.display = 'none';
        }

        // ===== SUBMIT BALLOT =====
        function submitBallot() {
            if (isSubmitting || isLocked || !selectedOption) return;

            if (!currentVoteToken) {
                alert('กำลังเตรียมบัตรลงคะแนน... กรุณารอสักครู่');
                fetchVoteToken();
                return;
            }

            if (!confirm('ยืนยันการลงคะแนน? คุณไม่สามารถแก้ไขได้ภายหลัง')) {
                return;
            }

            const btn = document.getElementById('submitBtn');
            btn.disabled = true;
            btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> กำลังบันทึก...';
            isSubmitting = true;

            document.getElementById('ballotPaper').style.opacity = '0.5';
            document.getElementById('loadingIndicator').style.display = 'block';

            const partyToSubmit = selectedOption;
            const tokenToUse = currentVoteToken;
            currentVoteToken = null;

            if (isApiConfigured()) {
                apiPost('submitVote', { party: partyToSubmit, token: tokenToUse })
                    .then(function (result) {
                        isSubmitting = false;
                        document.getElementById('ballotPaper').style.opacity = '1';
                        document.getElementById('loadingIndicator').style.display = 'none';

                        if (result.success) {
                            showSuccess(partyToSubmit);
                        } else {
                            alert(result.message);
                            btn.disabled = false;
                            btn.innerHTML = '<i class="fa-solid fa-box-archive"></i> หย่อนบัตร';
                            fetchVoteToken();
                            if (result.message.includes('ล็อค')) {
                                checkLockStatus();
                            }
                        }
                    })
                    .catch(function (err) {
                        isSubmitting = false;
                        document.getElementById('ballotPaper').style.opacity = '1';
                        document.getElementById('loadingIndicator').style.display = 'none';
                        alert('เกิดข้อผิดพลาด: ' + err.message);
                        btn.disabled = false;
                        btn.innerHTML = '<i class="fa-solid fa-box-archive"></i> หย่อนบัตร';
                        fetchVoteToken();
                    });
            } else {
                setTimeout(function () {
                    isSubmitting = false;
                    document.getElementById('ballotPaper').style.opacity = '1';
                    document.getElementById('loadingIndicator').style.display = 'none';
                    console.log("Submitted: Party " + partyToSubmit + ", Token: " + tokenToUse);
                    showSuccess(partyToSubmit);
                }, 1000);
            }
        }

        // ===== SHOW SUCCESS + RESET FOR NEXT VOTER =====
        function showSuccess(party) {
            const overlay = document.getElementById('successOverlay');
            const detail = document.getElementById('successDetail');

            if (party === 'noVote') {
                detail.innerHTML = '<i class="fa-solid fa-ban"></i> ไม่ประสงค์ลงคะแนน';
            } else {
                detail.innerHTML = '<i class="fa-solid fa-check-double"></i> ' + "เบอร์ " + party;
            }

            overlay.classList.add('active');
            createConfetti();

            const bar = document.getElementById('successBar');
            bar.style.width = '0%';
            setTimeout(function () { bar.style.width = '100%'; }, 100);

            setTimeout(function () {
                overlay.classList.remove('active');
                resetBallot();
                fetchVoteToken();
            }, 2600);
        }

        function createConfetti() {
            const container = document.getElementById('confettiContainer');
            container.innerHTML = '';
            const colors = ['#2A9D8F', '#E9C46A', '#E76F51', '#264653', '#F4A261', '#e63946', '#457B9D'];

            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.className = 'confetti-piece';
                confetti.style.left = Math.random() * 100 + '%';
                confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                confetti.style.animationDelay = Math.random() * 0.5 + 's';
                confetti.style.animationDuration = (Math.random() * 1.5 + 1.5) + 's';

                if (Math.random() > 0.5) {
                    confetti.style.borderRadius = '50%';
                    confetti.style.width = (Math.random() * 8 + 6) + 'px';
                    confetti.style.height = confetti.style.width;
                } else {
                    confetti.style.width = (Math.random() * 10 + 5) + 'px';
                    confetti.style.height = (Math.random() * 6 + 3) + 'px';
                }

                container.appendChild(confetti);
            }
        }

        function resetBallot() {
            selectedOption = null;
            isSubmitting = false;
            document.querySelectorAll('.ballot-option').forEach(function (opt) {
                opt.classList.remove('selected');
            });
            document.querySelectorAll('.ballot-checkbox').forEach(function (cb) {
                cb.classList.remove('checked');
            });
            document.getElementById('ballotPaper').classList.remove('has-selection');
            document.getElementById('submitBtn').disabled = true;
            document.getElementById('submitBtn').innerHTML = '<i class="fa-solid fa-box-archive"></i> หย่อนบัตร';
            document.getElementById('submitHint').innerHTML =
                '<i class="fa-solid fa-hand-pointer"></i> กรุณาเลือกกากบาทก่อนกดหย่อนบัตร';
            document.getElementById('submitHint').style.display = 'block';
        }

        // Check lock status
        function checkLockStatus() {
            if (isApiConfigured()) {
                apiGet('getVoteData')
                    .then(function (data) {
                        if (data && data.isLocked) {
                            isLocked = true;
                            document.getElementById('lockedBanner').style.display = 'flex';
                            document.getElementById('ballotWrapper').style.opacity = '0.5';
                            document.getElementById('ballotWrapper').style.pointerEvents = 'none';
                        }
                    })
                    .catch(function (err) { console.warn('Lock check failed:', err); });
            }
        }

        // Initialize
        window.onload = function () {
            checkLockStatus();
            setInterval(checkLockStatus, 10000);
        };

        // Toggle Mobile Menu
        function toggleMobileMenu() {
            var menu = document.getElementById('mobileMenu');
            var overlay = document.getElementById('menuOverlay');
            var btnIcon = document.querySelector('#menuToggleBtn i');

            if (!menu || !overlay || !btnIcon) return;

            menu.classList.toggle('active');
            overlay.classList.toggle('active');

            if (menu.classList.contains('active')) {
                btnIcon.className = 'fa-solid fa-xmark';
                document.body.style.overflow = 'hidden';
            } else {
                btnIcon.className = 'fa-solid fa-bars';
                document.body.style.overflow = '';
            }
        }
    </script>
</body>

</html>